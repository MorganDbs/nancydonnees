extends layout

block content
    style.
        #map {
          width: 100%;
          height: 500px;
        }
    .row
        .col-sm-12
            h2 Maps
            #map
            for event in eventDetails
                h2 Détails
                    h3= event.titre + ' (' + event.type + ')'
                    h4= event.adresse
                    h3 Description
                    div= event.description
                    h3 Date
                    div= 'Le ' + event.date + ' à ' + event.time + '.'
                h2 Commentaires
                    br
                    br

                    .col-sm-12
                        for comment in comments
                            .panel.panel-default
                                .panel-heading= comment.name + ' '
                                    small(id=comment._id)
                                .panel-body= comment.contenu
                form.form-horizontal(action="/comment/add", method='POST')
                    input(type='hidden', name='_csrf', value=_csrf)
                    input(type='hidden', name='id_user', value=user._id)
                    if(user.profile.name)
                        input(type='hidden', name='user', value=user.profile.name)
                    else
                        input(type='hidden', name='user', value='Anonyme')
                    input(type='hidden', name='id_event', value=event._id)
                    textarea(class='form-control', rows="3", name="commentaire", required, placeholder="Votre commentaire...")
                    br
                    if !auth
                        button(type='submit', class='btn btn-primary' disabled="true") Commenter
                        br
                        br
                        div Merci de 
                            a(href="/signup") créer un compte 
                            ou de vous 
                            a(href="/login") connecter

                    else
                        button(type='submit', class='btn btn-primary') Commenter

    script.
        var comments =!{JSON.stringify(comments)};
            comments.forEach(function(comment){
                var date = comment.updatedAt.split('T')[0];
                var heure = comment.updatedAt.split('T')[1];
                date = date.split('-');
                date = date[2] + "/" + date[1] + "/" + date[0];
                heure = heure.split('.')[0];
                heure = parseInt(heure.split(':')[0])+1 + ':' + heure.split(':')[1] + ':' + heure.split(':')[2];
                date = 'Le ' + date + ' à ' + heure;
                document.getElementById(comment._id).innerHTML = date;
            });

    script.
        var event =!{JSON.stringify(eventDetails)};
        event = event[0];
        function initMap() {

            var geocoder = new google.maps.Geocoder;

            geocoder.geocode( { 'address' : event.adresse }, function( results, status ) {
                if( status == google.maps.GeocoderStatus.OK ) {

                    map = new google.maps.Map(document.getElementById('map'), {
                        center: results[0].geometry.location,
                        zoom: 16
                    });

                    var marker = new google.maps.Marker( {
                        map: map,
                        position: results[0].geometry.location
                    } );

                    marker.addListener('click', function(){
                        infowindow.open(map, marker);
                    });
                }
            } );

            var infowindow = new google.maps.InfoWindow({
                content: '<div>'
                + '<h5>' + 'Titre : ' + event.titre + '</h5>'
                + '<h5>' + 'Adresse : ' + event.adresse + '</h5>'
                + '<h5>' + 'Type : ' + event.type + '</h5>'
                + '</div>'
            });
        };


    script(src='https://maps.googleapis.com/maps/api/js?key=AIzaSyDID5uSKinSpuwtZAWRcu5Fz6bMjj9yNXA&callback=initMap')

